# 用户协同过滤 | User-based Collaborative Filtering

## 🌟 基本概念 | Basic Concept

**用户协同过滤就像是你的智能购物顾问，它通过观察"和你品味相似的人"都买了什么，来推荐你可能喜欢的商品。**
**User-based collaborative filtering is like your intelligent shopping advisor, which recommends products you might like by observing what people with similar tastes to you have purchased.**

想象一下，你和朋友小明都喜欢科幻电影，经常去看漫威系列。有一天，小明去看了《沙丘》并给了高分评价，而你还没看过。这时，系统就会说："和你品味相似的小明很喜欢《沙丘》，你也可能会喜欢！"这就是用户协同过滤的思想。
Imagine this: you and your friend Xiao Ming both love science fiction movies and often watch Marvel series. One day, Xiao Ming watched "Dune" and gave it a high rating, while you haven't seen it yet. At this moment, the system would say: "Xiao Ming, who has similar tastes to you, really likes 'Dune', you might like it too!" This is the idea behind user-based collaborative filtering.

## 🎯 工作原理 | How it Works

**三步走策略：找相似用户 → 看他们喜欢什么 → 推荐给你**
**Three-step strategy: Find similar users → See what they like → Recommend to you**

1. **相似度计算 (Similarity Calculation)**
   系统会计算你和其他所有用户的相似度，就像计算两个向量的夹角。喜欢的电影越相似，夹角越小，相似度越高。
   The system calculates your similarity with all other users, like calculating the angle between two vectors. The more similar the movies you like, the smaller the angle, and the higher the similarity.

2. **邻居选择 (Neighbor Selection)**
   找出和你最相似的K个用户（比如最相似的10个人），他们就是你的"品味邻居"。
   Find the K users most similar to you (for example, the 10 most similar people), they are your "taste neighbors".

3. **评分预测 (Rating Prediction)**
   根据这些邻居对某个物品的评分，加权平均预测你对该物品的评分。
   Predict your rating for an item by taking a weighted average of the ratings from these neighbors.

## 📊 数学公式详解 | Mathematical Formula Explanation

### 相似度计算 - 余弦相似度
### Similarity Calculation - Cosine Similarity

假设我们有两个用户A和B，他们对一系列商品的评分可以用向量表示：
Assume we have two users A and B, their ratings for a series of products can be represented as vectors:

用户A的评分向量: \( \vec{A} = (a_1, a_2, \dots, a_n) \)
用户B的评分向量: \( \vec{B} = (b_1, b_2, \dots, b_n) \)

余弦相似度的计算公式为：
The cosine similarity formula is:

\[ \text{sim}(A,B) = \cos(\theta) = \frac{\vec{A} \cdot \vec{B}}{\|\vec{A}\| \|\vec{B}\|} = \frac{\sum_{i=1}^{n} a_i b_i}{\sqrt{\sum_{i=1}^{n} a_i^2} \sqrt{\sum_{i=1}^{n} b_i^2}} \]

**例子演示：**
**Example demonstration:**

假设：
Assume:
- 用户A对3部电影的评分: [5, 3, 4]
- 用户B对3部电影的评分: [4, 2, 5]

\[ \vec{A} \cdot \vec{B} = 5 \times 4 + 3 \times 2 + 4 \times 5 = 20 + 6 + 20 = 46 \]
\[ \|\vec{A}\| = \sqrt{5^2 + 3^2 + 4^2} = \sqrt{25 + 9 + 16} = \sqrt{50} \approx 7.07 \]
\[ \|\vec{B}\| = \sqrt{4^2 + 2^2 + 5^2} = \sqrt{16 + 4 + 25} = \sqrt{45} \approx 6.71 \]
\[ \text{sim}(A,B) = \frac{46}{7.07 \times 6.71} \approx \frac{46}{47.46} \approx 0.97 \]

相似度高达0.97，说明用户A和B的品味非常相似！
The similarity is as high as 0.97, indicating that users A and B have very similar tastes!

### 评分预测公式
### Rating Prediction Formula

预测用户u对物品i的评分：
Predict user u's rating for item i:

\[ \hat{r}_{ui} = \bar{r}_u + \frac{\sum_{v \in N(u)} \text{sim}(u,v) \times (r_{vi} - \bar{r}_v)}{\sum_{v \in N(u)} |\text{sim}(u,v)|} \]

其中：
Where:
- \( \hat{r}_{ui} \): 预测评分 Predicted rating
- \( \bar{r}_u \): 用户u的平均评分 User u's average rating
- \( N(u) \): 用户u的邻居集合 Neighborhood set of user u
- \( r_{vi} \): 邻居v对物品i的评分 Neighbor v's rating for item i
- \( \bar{r}_v \): 邻居v的平均评分 Neighbor v's average rating

## 🛠 实践项目 | Practical Project

我们将用PyTorch实现一个用户协同过滤推荐系统，包含数据处理、模型训练和推荐预测全流程。
We will implement a user-based collaborative filtering recommendation system using PyTorch, including the entire process of data processing, model training, and recommendation prediction.

## Rating Centralization | 评分中心化

**Concept:** Convert the user's actual rating into a deviation relative to the personal average rating, in order to eliminate the influence of the user's rating inertia.
**概念：** 将用户的实际评分转化为相对于个人平均评分的偏差，以消除用户评分惯性的影响。

**Formula:**
**公式：**

$r'_{u,i} = r_{u,i} - \bar{r}_u$

**Significance:**
- **消除偏见：** This processed rating reflects the user's preference relative to their own average level, allowing fair comparison between users with different "strictness levels".
- **提高准确性：** Even if user A always gives high scores and user B always gives low scores, centralization ensures fair treatment of their relative preferences.

**Example:**
**举例：**
- **User A gives all movies 4 stars, average rating is 4.0, gives "Shawshank Redemption" 5 stars → centralized rating is +1**
- **用户A给所有电影都评4分，平均评分4.0，给《肖申克的救赎》评5分→中心化评分为+1**
- **User B gives all movies 2 stars, average rating is 2.0, gives "Shawshank Redemption" 4 stars → centralized rating is +2**
- **用户B给所有电影都评2分，平均评分2.0，给《肖申克的救赎》评4分→中心化评分为+2**

**Conclusion:** From the analysis of centralized ratings, user B likes this movie more.
**结论：** 从中心化评分分析，用户B更喜欢这部电影

## Cold Start Problem | ❄️ 冷启动问题

**概念：** 当系统中缺乏足够的历史数据时，协同过滤系统难以提供有效的推荐。
**Concept:** When there is insufficient historical data in the system, it is difficult for the collaborative filtering system to provide effective recommendations.

**类型：**
**Types:**

**1. New User Problem | 新用户问题**
- **问题：** 新用户还没有产生任何评分记录。
- **Problem:** New users have not yet generated any rating records.
- **解决方案：** 提供初始热门推荐，引导用户评分喜欢的内容。
- **Solution:** Provide initial popular recommendations, guide users to rate liked content.

**2. New Item Problem | 新项目问题**
- **问题：** 新项目还没有被任何用户评分。
- **Problem:** New items have not yet been rated by any users.
- **解决方案：** 基于内容推荐，使用物品特征。
- **Solution:** Recommend based on content, use item features.

**3. New System Problem | 新系统问题**
- **问题：** 系统中用户和物品数量都非常少。
- **Problem:** Both the number of users and items in the system are very small.
- **解决方案：** 使用混合推荐系统，结合专家知识。
- **Solution:** Use a hybrid recommendation system, combine expert knowledge.