# ç”¨æˆ·ååŒè¿‡æ»¤ | User-based Collaborative Filtering

## ğŸŒŸ åŸºæœ¬æ¦‚å¿µ | Basic Concept

**ç”¨æˆ·ååŒè¿‡æ»¤å°±åƒæ˜¯ä½ çš„æ™ºèƒ½è´­ç‰©é¡¾é—®ï¼Œå®ƒé€šè¿‡è§‚å¯Ÿ"å’Œä½ å“å‘³ç›¸ä¼¼çš„äºº"éƒ½ä¹°äº†ä»€ä¹ˆï¼Œæ¥æ¨èä½ å¯èƒ½å–œæ¬¢çš„å•†å“ã€‚**
**User-based collaborative filtering is like your intelligent shopping advisor, which recommends products you might like by observing what people with similar tastes to you have purchased.**

æƒ³è±¡ä¸€ä¸‹ï¼Œä½ å’Œæœ‹å‹å°æ˜éƒ½å–œæ¬¢ç§‘å¹»ç”µå½±ï¼Œç»å¸¸å»çœ‹æ¼«å¨ç³»åˆ—ã€‚æœ‰ä¸€å¤©ï¼Œå°æ˜å»çœ‹äº†ã€Šæ²™ä¸˜ã€‹å¹¶ç»™äº†é«˜åˆ†è¯„ä»·ï¼Œè€Œä½ è¿˜æ²¡çœ‹è¿‡ã€‚è¿™æ—¶ï¼Œç³»ç»Ÿå°±ä¼šè¯´ï¼š"å’Œä½ å“å‘³ç›¸ä¼¼çš„å°æ˜å¾ˆå–œæ¬¢ã€Šæ²™ä¸˜ã€‹ï¼Œä½ ä¹Ÿå¯èƒ½ä¼šå–œæ¬¢ï¼"è¿™å°±æ˜¯ç”¨æˆ·ååŒè¿‡æ»¤çš„æ€æƒ³ã€‚
Imagine this: you and your friend Xiao Ming both love science fiction movies and often watch Marvel series. One day, Xiao Ming watched "Dune" and gave it a high rating, while you haven't seen it yet. At this moment, the system would say: "Xiao Ming, who has similar tastes to you, really likes 'Dune', you might like it too!" This is the idea behind user-based collaborative filtering.

## ğŸ¯ å·¥ä½œåŸç† | How it Works

**ä¸‰æ­¥èµ°ç­–ç•¥ï¼šæ‰¾ç›¸ä¼¼ç”¨æˆ· â†’ çœ‹ä»–ä»¬å–œæ¬¢ä»€ä¹ˆ â†’ æ¨èç»™ä½ **
**Three-step strategy: Find similar users â†’ See what they like â†’ Recommend to you**

1. **ç›¸ä¼¼åº¦è®¡ç®— (Similarity Calculation)**
   ç³»ç»Ÿä¼šè®¡ç®—ä½ å’Œå…¶ä»–æ‰€æœ‰ç”¨æˆ·çš„ç›¸ä¼¼åº¦ï¼Œå°±åƒè®¡ç®—ä¸¤ä¸ªå‘é‡çš„å¤¹è§’ã€‚å–œæ¬¢çš„ç”µå½±è¶Šç›¸ä¼¼ï¼Œå¤¹è§’è¶Šå°ï¼Œç›¸ä¼¼åº¦è¶Šé«˜ã€‚
   The system calculates your similarity with all other users, like calculating the angle between two vectors. The more similar the movies you like, the smaller the angle, and the higher the similarity.

2. **é‚»å±…é€‰æ‹© (Neighbor Selection)**
   æ‰¾å‡ºå’Œä½ æœ€ç›¸ä¼¼çš„Kä¸ªç”¨æˆ·ï¼ˆæ¯”å¦‚æœ€ç›¸ä¼¼çš„10ä¸ªäººï¼‰ï¼Œä»–ä»¬å°±æ˜¯ä½ çš„"å“å‘³é‚»å±…"ã€‚
   Find the K users most similar to you (for example, the 10 most similar people), they are your "taste neighbors".

3. **è¯„åˆ†é¢„æµ‹ (Rating Prediction)**
   æ ¹æ®è¿™äº›é‚»å±…å¯¹æŸä¸ªç‰©å“çš„è¯„åˆ†ï¼ŒåŠ æƒå¹³å‡é¢„æµ‹ä½ å¯¹è¯¥ç‰©å“çš„è¯„åˆ†ã€‚
   Predict your rating for an item by taking a weighted average of the ratings from these neighbors.

## ğŸ“Š æ•°å­¦å…¬å¼è¯¦è§£ | Mathematical Formula Explanation

### ç›¸ä¼¼åº¦è®¡ç®— - ä½™å¼¦ç›¸ä¼¼åº¦
### Similarity Calculation - Cosine Similarity

å‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªç”¨æˆ·Aå’ŒBï¼Œä»–ä»¬å¯¹ä¸€ç³»åˆ—å•†å“çš„è¯„åˆ†å¯ä»¥ç”¨å‘é‡è¡¨ç¤ºï¼š
Assume we have two users A and B, their ratings for a series of products can be represented as vectors:

ç”¨æˆ·Açš„è¯„åˆ†å‘é‡: \( \vec{A} = (a_1, a_2, \dots, a_n) \)
ç”¨æˆ·Bçš„è¯„åˆ†å‘é‡: \( \vec{B} = (b_1, b_2, \dots, b_n) \)

ä½™å¼¦ç›¸ä¼¼åº¦çš„è®¡ç®—å…¬å¼ä¸ºï¼š
The cosine similarity formula is:

\[ \text{sim}(A,B) = \cos(\theta) = \frac{\vec{A} \cdot \vec{B}}{\|\vec{A}\| \|\vec{B}\|} = \frac{\sum_{i=1}^{n} a_i b_i}{\sqrt{\sum_{i=1}^{n} a_i^2} \sqrt{\sum_{i=1}^{n} b_i^2}} \]

**ä¾‹å­æ¼”ç¤ºï¼š**
**Example demonstration:**

å‡è®¾ï¼š
Assume:
- ç”¨æˆ·Aå¯¹3éƒ¨ç”µå½±çš„è¯„åˆ†: [5, 3, 4]
- ç”¨æˆ·Bå¯¹3éƒ¨ç”µå½±çš„è¯„åˆ†: [4, 2, 5]

\[ \vec{A} \cdot \vec{B} = 5 \times 4 + 3 \times 2 + 4 \times 5 = 20 + 6 + 20 = 46 \]
\[ \|\vec{A}\| = \sqrt{5^2 + 3^2 + 4^2} = \sqrt{25 + 9 + 16} = \sqrt{50} \approx 7.07 \]
\[ \|\vec{B}\| = \sqrt{4^2 + 2^2 + 5^2} = \sqrt{16 + 4 + 25} = \sqrt{45} \approx 6.71 \]
\[ \text{sim}(A,B) = \frac{46}{7.07 \times 6.71} \approx \frac{46}{47.46} \approx 0.97 \]

ç›¸ä¼¼åº¦é«˜è¾¾0.97ï¼Œè¯´æ˜ç”¨æˆ·Aå’ŒBçš„å“å‘³éå¸¸ç›¸ä¼¼ï¼
The similarity is as high as 0.97, indicating that users A and B have very similar tastes!

### è¯„åˆ†é¢„æµ‹å…¬å¼
### Rating Prediction Formula

é¢„æµ‹ç”¨æˆ·uå¯¹ç‰©å“içš„è¯„åˆ†ï¼š
Predict user u's rating for item i:

\[ \hat{r}_{ui} = \bar{r}_u + \frac{\sum_{v \in N(u)} \text{sim}(u,v) \times (r_{vi} - \bar{r}_v)}{\sum_{v \in N(u)} |\text{sim}(u,v)|} \]

å…¶ä¸­ï¼š
Where:
- \( \hat{r}_{ui} \): é¢„æµ‹è¯„åˆ† Predicted rating
- \( \bar{r}_u \): ç”¨æˆ·uçš„å¹³å‡è¯„åˆ† User u's average rating
- \( N(u) \): ç”¨æˆ·uçš„é‚»å±…é›†åˆ Neighborhood set of user u
- \( r_{vi} \): é‚»å±…vå¯¹ç‰©å“içš„è¯„åˆ† Neighbor v's rating for item i
- \( \bar{r}_v \): é‚»å±…vçš„å¹³å‡è¯„åˆ† Neighbor v's average rating

## ğŸ›  å®è·µé¡¹ç›® | Practical Project

æˆ‘ä»¬å°†ç”¨PyTorchå®ç°ä¸€ä¸ªç”¨æˆ·ååŒè¿‡æ»¤æ¨èç³»ç»Ÿï¼ŒåŒ…å«æ•°æ®å¤„ç†ã€æ¨¡å‹è®­ç»ƒå’Œæ¨èé¢„æµ‹å…¨æµç¨‹ã€‚
We will implement a user-based collaborative filtering recommendation system using PyTorch, including the entire process of data processing, model training, and recommendation prediction.

## Rating Centralization | è¯„åˆ†ä¸­å¿ƒåŒ–

**Concept:** Convert the user's actual rating into a deviation relative to the personal average rating, in order to eliminate the influence of the user's rating inertia.
**æ¦‚å¿µï¼š** å°†ç”¨æˆ·çš„å®é™…è¯„åˆ†è½¬åŒ–ä¸ºç›¸å¯¹äºä¸ªäººå¹³å‡è¯„åˆ†çš„åå·®ï¼Œä»¥æ¶ˆé™¤ç”¨æˆ·è¯„åˆ†æƒ¯æ€§çš„å½±å“ã€‚

**Formula:**
**å…¬å¼ï¼š**

$r'_{u,i} = r_{u,i} - \bar{r}_u$

**Significance:**
- **æ¶ˆé™¤åè§ï¼š** This processed rating reflects the user's preference relative to their own average level, allowing fair comparison between users with different "strictness levels".
- **æé«˜å‡†ç¡®æ€§ï¼š** Even if user A always gives high scores and user B always gives low scores, centralization ensures fair treatment of their relative preferences.

**Example:**
**ä¸¾ä¾‹ï¼š**
- **User A gives all movies 4 stars, average rating is 4.0, gives "Shawshank Redemption" 5 stars â†’ centralized rating is +1**
- **ç”¨æˆ·Aç»™æ‰€æœ‰ç”µå½±éƒ½è¯„4åˆ†ï¼Œå¹³å‡è¯„åˆ†4.0ï¼Œç»™ã€Šè‚–ç”³å…‹çš„æ•‘èµã€‹è¯„5åˆ†â†’ä¸­å¿ƒåŒ–è¯„åˆ†ä¸º+1**
- **User B gives all movies 2 stars, average rating is 2.0, gives "Shawshank Redemption" 4 stars â†’ centralized rating is +2**
- **ç”¨æˆ·Bç»™æ‰€æœ‰ç”µå½±éƒ½è¯„2åˆ†ï¼Œå¹³å‡è¯„åˆ†2.0ï¼Œç»™ã€Šè‚–ç”³å…‹çš„æ•‘èµã€‹è¯„4åˆ†â†’ä¸­å¿ƒåŒ–è¯„åˆ†ä¸º+2**

**Conclusion:** From the analysis of centralized ratings, user B likes this movie more.
**ç»“è®ºï¼š** ä»ä¸­å¿ƒåŒ–è¯„åˆ†åˆ†æï¼Œç”¨æˆ·Bæ›´å–œæ¬¢è¿™éƒ¨ç”µå½±

## Cold Start Problem | â„ï¸ å†·å¯åŠ¨é—®é¢˜

**æ¦‚å¿µï¼š** å½“ç³»ç»Ÿä¸­ç¼ºä¹è¶³å¤Ÿçš„å†å²æ•°æ®æ—¶ï¼ŒååŒè¿‡æ»¤ç³»ç»Ÿéš¾ä»¥æä¾›æœ‰æ•ˆçš„æ¨èã€‚
**Concept:** When there is insufficient historical data in the system, it is difficult for the collaborative filtering system to provide effective recommendations.

**ç±»å‹ï¼š**
**Types:**

**1. New User Problem | æ–°ç”¨æˆ·é—®é¢˜**
- **é—®é¢˜ï¼š** æ–°ç”¨æˆ·è¿˜æ²¡æœ‰äº§ç”Ÿä»»ä½•è¯„åˆ†è®°å½•ã€‚
- **Problem:** New users have not yet generated any rating records.
- **è§£å†³æ–¹æ¡ˆï¼š** æä¾›åˆå§‹çƒ­é—¨æ¨èï¼Œå¼•å¯¼ç”¨æˆ·è¯„åˆ†å–œæ¬¢çš„å†…å®¹ã€‚
- **Solution:** Provide initial popular recommendations, guide users to rate liked content.

**2. New Item Problem | æ–°é¡¹ç›®é—®é¢˜**
- **é—®é¢˜ï¼š** æ–°é¡¹ç›®è¿˜æ²¡æœ‰è¢«ä»»ä½•ç”¨æˆ·è¯„åˆ†ã€‚
- **Problem:** New items have not yet been rated by any users.
- **è§£å†³æ–¹æ¡ˆï¼š** åŸºäºå†…å®¹æ¨èï¼Œä½¿ç”¨ç‰©å“ç‰¹å¾ã€‚
- **Solution:** Recommend based on content, use item features.

**3. New System Problem | æ–°ç³»ç»Ÿé—®é¢˜**
- **é—®é¢˜ï¼š** ç³»ç»Ÿä¸­ç”¨æˆ·å’Œç‰©å“æ•°é‡éƒ½éå¸¸å°‘ã€‚
- **Problem:** Both the number of users and items in the system are very small.
- **è§£å†³æ–¹æ¡ˆï¼š** ä½¿ç”¨æ··åˆæ¨èç³»ç»Ÿï¼Œç»“åˆä¸“å®¶çŸ¥è¯†ã€‚
- **Solution:** Use a hybrid recommendation system, combine expert knowledge.